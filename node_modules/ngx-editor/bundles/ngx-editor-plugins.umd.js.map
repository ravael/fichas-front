{"version":3,"file":"ngx-editor-plugins.umd.js","sources":["../../../src/plugins/placeholder.ts","../../../src/plugins/editable.ts","../../../src/plugins/image.ts","../../../src/plugins/ngx-editor-plugins.ts"],"sourcesContent":["import { Plugin, EditorState, PluginKey, Transaction } from 'prosemirror-state';\nimport { DecorationSet, Decoration } from 'prosemirror-view';\n\nconst PLACEHOLDER_CLASSNAME = 'NgxEditor__Placeholder';\n\nconst placeholderPlugin = (text?: string): Plugin => {\n  return new Plugin({\n    key: new PluginKey('placeholder'),\n    state: {\n      init(): string {\n        return text ?? '';\n      },\n      apply(tr: Transaction, previousVal: string): string {\n        const placeholder = tr.getMeta('UPDATE_PLACEHOLDER') ?? previousVal;\n        return placeholder;\n      }\n    },\n    props: {\n      decorations(state: EditorState): DecorationSet {\n        const doc = state.doc;\n\n        const placeholder = this.getState(state);\n\n        if (!placeholder) {\n          return DecorationSet.empty;\n        }\n\n        if (doc.childCount === 1 && doc?.firstChild?.isTextblock && doc.firstChild.content.size === 0) {\n          const placeHolderEl = document.createElement('span');\n          placeHolderEl.classList.add(PLACEHOLDER_CLASSNAME);\n          placeHolderEl.textContent = placeholder;\n          return DecorationSet.create(doc, [Decoration.widget(1, placeHolderEl)]);\n        }\n\n        return DecorationSet.empty;\n      }\n    }\n  });\n};\n\nexport default placeholderPlugin;\n","import { EditorState, Plugin, PluginKey, Transaction } from 'prosemirror-state';\n\nconst editablePlugin = (editable = true) => {\n  return new Plugin({\n    key: new PluginKey('editable'),\n    state: {\n      init(): boolean {\n        return editable;\n      },\n      apply(tr: Transaction, previousVal: boolean): string {\n        return tr.getMeta('UPDATE_EDITABLE') ?? previousVal;\n      }\n    },\n    props: {\n      editable(state: EditorState): boolean {\n        return this.getState(state);\n      },\n      attributes(state: EditorState): Record<string, string> | null {\n        const isEnabled = this.getState(state);\n\n        if (isEnabled) {\n          return null;\n        }\n\n        return {\n          class: 'NgxEditor__Content--Disabled'\n        };\n      }\n    }\n  });\n};\n\nexport default editablePlugin;\n","import { Node as ProsemirrorNode } from 'prosemirror-model';\nimport { NodeSelection, Plugin, PluginKey } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\n\nconst WRAPPER_CLASSNAME = 'NgxEditor__ImageWrapper';\nconst WRAPPER_RESIZE_ACTIVE_CLASSNAME = 'NgxEditor__Resizer--Active';\nconst RESIZE_HANDLE_CLASSNAME = 'NgxEditor__ResizeHandle';\n\nconst createHandle = (direction: string): HTMLElement => {\n  const handle = document.createElement('span');\n  handle.className = `${RESIZE_HANDLE_CLASSNAME}--${direction}`;\n  return handle;\n};\n\nclass ImageRezieView {\n  img: HTMLElement;\n  dom: HTMLElement;\n  handle: HTMLElement;\n\n  constructor(node: ProsemirrorNode, view: EditorView, getPos: () => number) {\n    const outer = document.createElement('span');\n    outer.className = WRAPPER_CLASSNAME;\n    outer.style.width = node.attrs.width;\n\n    const handle = document.createElement('span');\n    handle.className = RESIZE_HANDLE_CLASSNAME;\n\n    const img = document.createElement('img');\n    img.setAttribute('src', node.attrs.src);\n    img.setAttribute('alt', node.attrs.alt ?? '');\n    img.setAttribute('title', node.attrs.title ?? '');\n    img.style.width = '100%';\n    img.style.height = '100%';\n\n    const handleBottomRight = createHandle('BR');\n    const handleTopRight = createHandle('TL');\n    const handleTopLeft = createHandle('TR');\n    const handleBottomLeft = createHandle('BL');\n\n    const resizePropoptionally = (evt: MouseEvent) => {\n      evt.preventDefault();\n\n      const { state, dispatch } = view;\n      const { tr } = state;\n\n      const startX = evt.pageX;\n      const startWidth = img.clientWidth;\n\n      const { width } = window.getComputedStyle(view.dom);\n      const editorWidth = parseInt(width, 10);\n\n      const onMouseMove = (e: MouseEvent) => {\n        const currentX = e.pageX;\n        const diffInPx = currentX - startX;\n        const computedWidth = startWidth + diffInPx;\n\n        // prevent image overflow the editor\n        // prevent resizng below 20px\n        if (computedWidth > editorWidth || computedWidth < 20) {\n          return;\n        }\n\n        outer.style.width = `${computedWidth}px`;\n      };\n\n      const onMouseUp = (e: MouseEvent) => {\n        e.preventDefault();\n\n        document.removeEventListener('mousemove', onMouseMove);\n        document.removeEventListener('mouseup', onMouseUp);\n\n        const transaction = tr.setNodeMarkup(getPos(), undefined, {\n          src: node.attrs.src,\n          width: outer.style.width\n        });\n\n        const resolvedPos = transaction.doc.resolve(getPos());\n        const newSelection = new NodeSelection(resolvedPos);\n\n        transaction.setSelection(newSelection);\n        dispatch(transaction);\n      };\n\n      document.addEventListener('mousemove', onMouseMove);\n      document.addEventListener('mouseup', onMouseUp);\n    };\n\n    handleBottomRight.addEventListener('mousedown', resizePropoptionally, { once: true });\n    handleTopRight.addEventListener('mousedown', resizePropoptionally, { once: true });\n    handleTopLeft.addEventListener('mousedown', resizePropoptionally, { once: true });\n    handleBottomLeft.addEventListener('mousedown', resizePropoptionally, { once: true });\n\n    handle.appendChild(handleBottomRight);\n    handle.appendChild(handleTopRight);\n    handle.appendChild(handleTopLeft);\n    handle.appendChild(handleBottomLeft);\n\n    outer.appendChild(handle);\n    outer.appendChild(img);\n\n    this.dom = outer;\n    this.img = img;\n    this.handle = handle;\n  }\n\n  selectNode(): void {\n    this.dom.classList.add(WRAPPER_RESIZE_ACTIVE_CLASSNAME);\n    this.handle.style.display = 'block';\n  }\n\n  deselectNode(): void {\n    this.dom.classList.remove(WRAPPER_RESIZE_ACTIVE_CLASSNAME);\n    this.handle.style.display = 'none';\n  }\n}\n\nconst defaultOptions = {\n  resize: true,\n};\n\nconst imagePlugin = (opts = defaultOptions): Plugin => {\n  const options = { ...defaultOptions, ...opts };\n\n  return new Plugin({\n    key: new PluginKey('link'),\n    props: {\n      nodeViews: {\n        image: (node: ProsemirrorNode, view: EditorView, getPos: () => number) => {\n          if (!options.resize) {\n            return null;\n          }\n          return new ImageRezieView(node, view, getPos);\n        },\n      }\n    }\n  });\n};\n\nexport default imagePlugin;\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["Plugin","PluginKey","DecorationSet","Decoration","NodeSelection"],"mappings":";;;;;;IAGA,IAAM,qBAAqB,GAAG,wBAAwB,CAAC;QAEjD,iBAAiB,GAAG,UAAC,IAAa;QACtC,OAAO,IAAIA,uBAAM,CAAC;YAChB,GAAG,EAAE,IAAIC,0BAAS,CAAC,aAAa,CAAC;YACjC,KAAK,EAAE;gBACL,IAAI;oBACF,OAAO,IAAI,aAAJ,IAAI,cAAJ,IAAI,GAAI,EAAE,CAAC;iBACnB;gBACD,KAAK,YAAC,EAAe,EAAE,WAAmB;;oBACxC,IAAM,WAAW,SAAG,EAAE,CAAC,OAAO,CAAC,oBAAoB,CAAC,mCAAI,WAAW,CAAC;oBACpE,OAAO,WAAW,CAAC;iBACpB;aACF;YACD,KAAK,EAAE;gBACL,WAAW,YAAC,KAAkB;;oBAC5B,IAAM,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC;oBAEtB,IAAM,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;oBAEzC,IAAI,CAAC,WAAW,EAAE;wBAChB,OAAOC,6BAAa,CAAC,KAAK,CAAC;qBAC5B;oBAED,IAAI,GAAG,CAAC,UAAU,KAAK,CAAC,WAAI,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,UAAU,0CAAE,WAAW,CAAA,IAAI,GAAG,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,KAAK,CAAC,EAAE;wBAC7F,IAAM,aAAa,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;wBACrD,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;wBACnD,aAAa,CAAC,WAAW,GAAG,WAAW,CAAC;wBACxC,OAAOA,6BAAa,CAAC,MAAM,CAAC,GAAG,EAAE,CAACC,0BAAU,CAAC,MAAM,CAAC,CAAC,EAAE,aAAa,CAAC,CAAC,CAAC,CAAC;qBACzE;oBAED,OAAOD,6BAAa,CAAC,KAAK,CAAC;iBAC5B;aACF;SACF,CAAC,CAAC;IACL,EAAE;;;QCpCI,cAAc,GAAG,UAAC,QAAe;QAAf,yBAAA,EAAA,eAAe;QACrC,OAAO,IAAIF,uBAAM,CAAC;YAChB,GAAG,EAAE,IAAIC,0BAAS,CAAC,UAAU,CAAC;YAC9B,KAAK,EAAE;gBACL,IAAI;oBACF,OAAO,QAAQ,CAAC;iBACjB;gBACD,KAAK,YAAC,EAAe,EAAE,WAAoB;;oBACzC,aAAO,EAAE,CAAC,OAAO,CAAC,iBAAiB,CAAC,mCAAI,WAAW,CAAC;iBACrD;aACF;YACD,KAAK,EAAE;gBACL,QAAQ,YAAC,KAAkB;oBACzB,OAAO,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;iBAC7B;gBACD,UAAU,YAAC,KAAkB;oBAC3B,IAAM,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;oBAEvC,IAAI,SAAS,EAAE;wBACb,OAAO,IAAI,CAAC;qBACb;oBAED,OAAO;wBACL,KAAK,EAAE,8BAA8B;qBACtC,CAAC;iBACH;aACF;SACF,CAAC,CAAC;IACL,EAAE;;;IC1BF,IAAM,iBAAiB,GAAG,yBAAyB,CAAC;IACpD,IAAM,+BAA+B,GAAG,4BAA4B,CAAC;IACrE,IAAM,uBAAuB,GAAG,yBAAyB,CAAC;IAE1D,IAAM,YAAY,GAAG,UAAC,SAAiB;QACrC,IAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAC9C,MAAM,CAAC,SAAS,GAAM,uBAAuB,UAAK,SAAW,CAAC;QAC9D,OAAO,MAAM,CAAC;IAChB,CAAC,CAAC;;IAEF;QAKE,wBAAY,IAAqB,EAAE,IAAgB,EAAE,MAAoB;;YACvE,IAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;YAC7C,KAAK,CAAC,SAAS,GAAG,iBAAiB,CAAC;YACpC,KAAK,CAAC,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC;YAErC,IAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;YAC9C,MAAM,CAAC,SAAS,GAAG,uBAAuB,CAAC;YAE3C,IAAM,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YAC1C,GAAG,CAAC,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YACxC,GAAG,CAAC,YAAY,CAAC,KAAK,QAAE,IAAI,CAAC,KAAK,CAAC,GAAG,mCAAI,EAAE,CAAC,CAAC;YAC9C,GAAG,CAAC,YAAY,CAAC,OAAO,QAAE,IAAI,CAAC,KAAK,CAAC,KAAK,mCAAI,EAAE,CAAC,CAAC;YAClD,GAAG,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;YACzB,GAAG,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;YAE1B,IAAM,iBAAiB,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;YAC7C,IAAM,cAAc,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;YAC1C,IAAM,aAAa,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;YACzC,IAAM,gBAAgB,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;YAE5C,IAAM,oBAAoB,GAAG,UAAC,GAAe;gBAC3C,GAAG,CAAC,cAAc,EAAE,CAAC;gBAEb,IAAA,KAAK,GAAe,IAAI,MAAnB,EAAE,QAAQ,GAAK,IAAI,SAAT,CAAU;gBACzB,IAAA,EAAE,GAAK,KAAK,GAAV,CAAW;gBAErB,IAAM,MAAM,GAAG,GAAG,CAAC,KAAK,CAAC;gBACzB,IAAM,UAAU,GAAG,GAAG,CAAC,WAAW,CAAC;gBAE3B,IAAA,KAAK,GAAK,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,MAAtC,CAAuC;gBACpD,IAAM,WAAW,GAAG,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;gBAExC,IAAM,WAAW,GAAG,UAAC,CAAa;oBAChC,IAAM,QAAQ,GAAG,CAAC,CAAC,KAAK,CAAC;oBACzB,IAAM,QAAQ,GAAG,QAAQ,GAAG,MAAM,CAAC;oBACnC,IAAM,aAAa,GAAG,UAAU,GAAG,QAAQ,CAAC;;;oBAI5C,IAAI,aAAa,GAAG,WAAW,IAAI,aAAa,GAAG,EAAE,EAAE;wBACrD,OAAO;qBACR;oBAED,KAAK,CAAC,KAAK,CAAC,KAAK,GAAM,aAAa,OAAI,CAAC;iBAC1C,CAAC;gBAEF,IAAM,SAAS,GAAG,UAAC,CAAa;oBAC9B,CAAC,CAAC,cAAc,EAAE,CAAC;oBAEnB,QAAQ,CAAC,mBAAmB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;oBACvD,QAAQ,CAAC,mBAAmB,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;oBAEnD,IAAM,WAAW,GAAG,EAAE,CAAC,aAAa,CAAC,MAAM,EAAE,EAAE,SAAS,EAAE;wBACxD,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG;wBACnB,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,KAAK;qBACzB,CAAC,CAAC;oBAEH,IAAM,WAAW,GAAG,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,CAAC;oBACtD,IAAM,YAAY,GAAG,IAAIG,8BAAa,CAAC,WAAW,CAAC,CAAC;oBAEpD,WAAW,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;oBACvC,QAAQ,CAAC,WAAW,CAAC,CAAC;iBACvB,CAAC;gBAEF,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;gBACpD,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;aACjD,CAAC;YAEF,iBAAiB,CAAC,gBAAgB,CAAC,WAAW,EAAE,oBAAoB,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;YACtF,cAAc,CAAC,gBAAgB,CAAC,WAAW,EAAE,oBAAoB,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;YACnF,aAAa,CAAC,gBAAgB,CAAC,WAAW,EAAE,oBAAoB,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;YAClF,gBAAgB,CAAC,gBAAgB,CAAC,WAAW,EAAE,oBAAoB,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;YAErF,MAAM,CAAC,WAAW,CAAC,iBAAiB,CAAC,CAAC;YACtC,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;YACnC,MAAM,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;YAClC,MAAM,CAAC,WAAW,CAAC,gBAAgB,CAAC,CAAC;YAErC,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;YAC1B,KAAK,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YAEvB,IAAI,CAAC,GAAG,GAAG,KAAK,CAAC;YACjB,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;YACf,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;SACtB;QAED,mCAAU,GAAV;YACE,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC;YACxD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;SACrC;QAED,qCAAY,GAAZ;YACE,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,+BAA+B,CAAC,CAAC;YAC3D,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;SACpC;6BACF;KAAA,IAAA;IAED,IAAM,cAAc,GAAG;QACrB,MAAM,EAAE,IAAI;KACb,CAAC;QAEI,WAAW,GAAG,UAAC,IAAqB;QAArB,qBAAA,EAAA,qBAAqB;QACxC,IAAM,OAAO,mCAAQ,cAAc,GAAK,IAAI,CAAE,CAAC;QAE/C,OAAO,IAAIJ,uBAAM,CAAC;YAChB,GAAG,EAAE,IAAIC,0BAAS,CAAC,MAAM,CAAC;YAC1B,KAAK,EAAE;gBACL,SAAS,EAAE;oBACT,KAAK,EAAE,UAAC,IAAqB,EAAE,IAAgB,EAAE,MAAoB;wBACnE,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;4BACnB,OAAO,IAAI,CAAC;yBACb;wBACD,OAAO,IAAI,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,MAAM,CAAC,CAAC;qBAC/C;iBACF;aACF;SACF,CAAC,CAAC;IACL,EAAE;;;ICxIF;;;;;;;;;;;;;;"}