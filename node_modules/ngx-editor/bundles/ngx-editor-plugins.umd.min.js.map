{"version":3,"sources":["../../../src/plugins/placeholder.ts","../../../src/plugins/editable.ts","../../../src/plugins/image.ts"],"names":["placeholderPlugin","text","Plugin","key","PluginKey","state","init","apply","tr","previousVal","_a","getMeta","props","decorations","doc","placeholder","this","getState","DecorationSet","empty","childCount","firstChild","isTextblock","content","size","placeHolderEl","document","createElement","classList","add","textContent","create","Decoration","widget","editablePlugin","editable","attributes","class","WRAPPER_RESIZE_ACTIVE_CLASSNAME","RESIZE_HANDLE_CLASSNAME","createHandle","direction","handle","className","ImageRezieView","node","view","getPos","outer","style","width","attrs","img","setAttribute","src","alt","_b","title","height","handleBottomRight","handleTopRight","handleTopLeft","handleBottomLeft","resizePropoptionally","evt","preventDefault","dispatch","startX","pageX","startWidth","clientWidth","window","getComputedStyle","dom","editorWidth","parseInt","onMouseMove","e","currentX","computedWidth","onMouseUp","removeEventListener","transaction","setNodeMarkup","undefined","resolvedPos","resolve","newSelection","NodeSelection","setSelection","addEventListener","once","appendChild","prototype","selectNode","display","deselectNode","remove","defaultOptions","resize","imagePlugin","opts","options","Object","assign","nodeViews","image"],"mappings":"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","sourcesContent":["import { Plugin, EditorState, PluginKey, Transaction } from 'prosemirror-state';\nimport { DecorationSet, Decoration } from 'prosemirror-view';\n\nconst PLACEHOLDER_CLASSNAME = 'NgxEditor__Placeholder';\n\nconst placeholderPlugin = (text?: string): Plugin => {\n  return new Plugin({\n    key: new PluginKey('placeholder'),\n    state: {\n      init(): string {\n        return text ?? '';\n      },\n      apply(tr: Transaction, previousVal: string): string {\n        const placeholder = tr.getMeta('UPDATE_PLACEHOLDER') ?? previousVal;\n        return placeholder;\n      }\n    },\n    props: {\n      decorations(state: EditorState): DecorationSet {\n        const doc = state.doc;\n\n        const placeholder = this.getState(state);\n\n        if (!placeholder) {\n          return DecorationSet.empty;\n        }\n\n        if (doc.childCount === 1 && doc?.firstChild?.isTextblock && doc.firstChild.content.size === 0) {\n          const placeHolderEl = document.createElement('span');\n          placeHolderEl.classList.add(PLACEHOLDER_CLASSNAME);\n          placeHolderEl.textContent = placeholder;\n          return DecorationSet.create(doc, [Decoration.widget(1, placeHolderEl)]);\n        }\n\n        return DecorationSet.empty;\n      }\n    }\n  });\n};\n\nexport default placeholderPlugin;\n","import { EditorState, Plugin, PluginKey, Transaction } from 'prosemirror-state';\n\nconst editablePlugin = (editable = true) => {\n  return new Plugin({\n    key: new PluginKey('editable'),\n    state: {\n      init(): boolean {\n        return editable;\n      },\n      apply(tr: Transaction, previousVal: boolean): string {\n        return tr.getMeta('UPDATE_EDITABLE') ?? previousVal;\n      }\n    },\n    props: {\n      editable(state: EditorState): boolean {\n        return this.getState(state);\n      },\n      attributes(state: EditorState): Record<string, string> | null {\n        const isEnabled = this.getState(state);\n\n        if (isEnabled) {\n          return null;\n        }\n\n        return {\n          class: 'NgxEditor__Content--Disabled'\n        };\n      }\n    }\n  });\n};\n\nexport default editablePlugin;\n","import { Node as ProsemirrorNode } from 'prosemirror-model';\nimport { NodeSelection, Plugin, PluginKey } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\n\nconst WRAPPER_CLASSNAME = 'NgxEditor__ImageWrapper';\nconst WRAPPER_RESIZE_ACTIVE_CLASSNAME = 'NgxEditor__Resizer--Active';\nconst RESIZE_HANDLE_CLASSNAME = 'NgxEditor__ResizeHandle';\n\nconst createHandle = (direction: string): HTMLElement => {\n  const handle = document.createElement('span');\n  handle.className = `${RESIZE_HANDLE_CLASSNAME}--${direction}`;\n  return handle;\n};\n\nclass ImageRezieView {\n  img: HTMLElement;\n  dom: HTMLElement;\n  handle: HTMLElement;\n\n  constructor(node: ProsemirrorNode, view: EditorView, getPos: () => number) {\n    const outer = document.createElement('span');\n    outer.className = WRAPPER_CLASSNAME;\n    outer.style.width = node.attrs.width;\n\n    const handle = document.createElement('span');\n    handle.className = RESIZE_HANDLE_CLASSNAME;\n\n    const img = document.createElement('img');\n    img.setAttribute('src', node.attrs.src);\n    img.setAttribute('alt', node.attrs.alt ?? '');\n    img.setAttribute('title', node.attrs.title ?? '');\n    img.style.width = '100%';\n    img.style.height = '100%';\n\n    const handleBottomRight = createHandle('BR');\n    const handleTopRight = createHandle('TL');\n    const handleTopLeft = createHandle('TR');\n    const handleBottomLeft = createHandle('BL');\n\n    const resizePropoptionally = (evt: MouseEvent) => {\n      evt.preventDefault();\n\n      const { state, dispatch } = view;\n      const { tr } = state;\n\n      const startX = evt.pageX;\n      const startWidth = img.clientWidth;\n\n      const { width } = window.getComputedStyle(view.dom);\n      const editorWidth = parseInt(width, 10);\n\n      const onMouseMove = (e: MouseEvent) => {\n        const currentX = e.pageX;\n        const diffInPx = currentX - startX;\n        const computedWidth = startWidth + diffInPx;\n\n        // prevent image overflow the editor\n        // prevent resizng below 20px\n        if (computedWidth > editorWidth || computedWidth < 20) {\n          return;\n        }\n\n        outer.style.width = `${computedWidth}px`;\n      };\n\n      const onMouseUp = (e: MouseEvent) => {\n        e.preventDefault();\n\n        document.removeEventListener('mousemove', onMouseMove);\n        document.removeEventListener('mouseup', onMouseUp);\n\n        const transaction = tr.setNodeMarkup(getPos(), undefined, {\n          src: node.attrs.src,\n          width: outer.style.width\n        });\n\n        const resolvedPos = transaction.doc.resolve(getPos());\n        const newSelection = new NodeSelection(resolvedPos);\n\n        transaction.setSelection(newSelection);\n        dispatch(transaction);\n      };\n\n      document.addEventListener('mousemove', onMouseMove);\n      document.addEventListener('mouseup', onMouseUp);\n    };\n\n    handleBottomRight.addEventListener('mousedown', resizePropoptionally, { once: true });\n    handleTopRight.addEventListener('mousedown', resizePropoptionally, { once: true });\n    handleTopLeft.addEventListener('mousedown', resizePropoptionally, { once: true });\n    handleBottomLeft.addEventListener('mousedown', resizePropoptionally, { once: true });\n\n    handle.appendChild(handleBottomRight);\n    handle.appendChild(handleTopRight);\n    handle.appendChild(handleTopLeft);\n    handle.appendChild(handleBottomLeft);\n\n    outer.appendChild(handle);\n    outer.appendChild(img);\n\n    this.dom = outer;\n    this.img = img;\n    this.handle = handle;\n  }\n\n  selectNode(): void {\n    this.dom.classList.add(WRAPPER_RESIZE_ACTIVE_CLASSNAME);\n    this.handle.style.display = 'block';\n  }\n\n  deselectNode(): void {\n    this.dom.classList.remove(WRAPPER_RESIZE_ACTIVE_CLASSNAME);\n    this.handle.style.display = 'none';\n  }\n}\n\nconst defaultOptions = {\n  resize: true,\n};\n\nconst imagePlugin = (opts = defaultOptions): Plugin => {\n  const options = { ...defaultOptions, ...opts };\n\n  return new Plugin({\n    key: new PluginKey('link'),\n    props: {\n      nodeViews: {\n        image: (node: ProsemirrorNode, view: EditorView, getPos: () => number) => {\n          if (!options.resize) {\n            return null;\n          }\n          return new ImageRezieView(node, view, getPos);\n        },\n      }\n    }\n  });\n};\n\nexport default imagePlugin;\n"]}