{"version":3,"file":"ngx-editor-plugins.js","sources":["../../../src/plugins/placeholder.ts","../../../src/plugins/editable.ts","../../../src/plugins/image.ts","../../../src/plugins/ngx-editor-plugins.ts"],"names":[],"mappings":"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","sourcesContent":["import { Plugin, EditorState, PluginKey, Transaction } from 'prosemirror-state';\nimport { DecorationSet, Decoration } from 'prosemirror-view';\n\nconst PLACEHOLDER_CLASSNAME = 'NgxEditor__Placeholder';\n\nconst placeholderPlugin = (text?: string): Plugin => {\n  return new Plugin({\n    key: new PluginKey('placeholder'),\n    state: {\n      init(): string {\n        return text ?? '';\n      },\n      apply(tr: Transaction, previousVal: string): string {\n        const placeholder = tr.getMeta('UPDATE_PLACEHOLDER') ?? previousVal;\n        return placeholder;\n      }\n    },\n    props: {\n      decorations(state: EditorState): DecorationSet {\n        const doc = state.doc;\n\n        const placeholder = this.getState(state);\n\n        if (!placeholder) {\n          return DecorationSet.empty;\n        }\n\n        if (doc.childCount === 1 && doc?.firstChild?.isTextblock && doc.firstChild.content.size === 0) {\n          const placeHolderEl = document.createElement('span');\n          placeHolderEl.classList.add(PLACEHOLDER_CLASSNAME);\n          placeHolderEl.textContent = placeholder;\n          return DecorationSet.create(doc, [Decoration.widget(1, placeHolderEl)]);\n        }\n\n        return DecorationSet.empty;\n      }\n    }\n  });\n};\n\nexport default placeholderPlugin;\n","import { EditorState, Plugin, PluginKey, Transaction } from 'prosemirror-state';\n\nconst editablePlugin = (editable = true) => {\n  return new Plugin({\n    key: new PluginKey('editable'),\n    state: {\n      init(): boolean {\n        return editable;\n      },\n      apply(tr: Transaction, previousVal: boolean): string {\n        return tr.getMeta('UPDATE_EDITABLE') ?? previousVal;\n      }\n    },\n    props: {\n      editable(state: EditorState): boolean {\n        return this.getState(state);\n      },\n      attributes(state: EditorState): Record<string, string> | null {\n        const isEnabled = this.getState(state);\n\n        if (isEnabled) {\n          return null;\n        }\n\n        return {\n          class: 'NgxEditor__Content--Disabled'\n        };\n      }\n    }\n  });\n};\n\nexport default editablePlugin;\n","import { Node as ProsemirrorNode } from 'prosemirror-model';\nimport { NodeSelection, Plugin, PluginKey } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\n\nconst WRAPPER_CLASSNAME = 'NgxEditor__ImageWrapper';\nconst WRAPPER_RESIZE_ACTIVE_CLASSNAME = 'NgxEditor__Resizer--Active';\nconst RESIZE_HANDLE_CLASSNAME = 'NgxEditor__ResizeHandle';\n\nconst createHandle = (direction: string): HTMLElement => {\n  const handle = document.createElement('span');\n  handle.className = `${RESIZE_HANDLE_CLASSNAME}--${direction}`;\n  return handle;\n};\n\nclass ImageRezieView {\n  img: HTMLElement;\n  dom: HTMLElement;\n  handle: HTMLElement;\n\n  constructor(node: ProsemirrorNode, view: EditorView, getPos: () => number) {\n    const outer = document.createElement('span');\n    outer.className = WRAPPER_CLASSNAME;\n    outer.style.width = node.attrs.width;\n\n    const handle = document.createElement('span');\n    handle.className = RESIZE_HANDLE_CLASSNAME;\n\n    const img = document.createElement('img');\n    img.setAttribute('src', node.attrs.src);\n    img.setAttribute('alt', node.attrs.alt ?? '');\n    img.setAttribute('title', node.attrs.title ?? '');\n    img.style.width = '100%';\n    img.style.height = '100%';\n\n    const handleBottomRight = createHandle('BR');\n    const handleTopRight = createHandle('TL');\n    const handleTopLeft = createHandle('TR');\n    const handleBottomLeft = createHandle('BL');\n\n    const resizePropoptionally = (evt: MouseEvent) => {\n      evt.preventDefault();\n\n      const { state, dispatch } = view;\n      const { tr } = state;\n\n      const startX = evt.pageX;\n      const startWidth = img.clientWidth;\n\n      const { width } = window.getComputedStyle(view.dom);\n      const editorWidth = parseInt(width, 10);\n\n      const onMouseMove = (e: MouseEvent) => {\n        const currentX = e.pageX;\n        const diffInPx = currentX - startX;\n        const computedWidth = startWidth + diffInPx;\n\n        // prevent image overflow the editor\n        // prevent resizng below 20px\n        if (computedWidth > editorWidth || computedWidth < 20) {\n          return;\n        }\n\n        outer.style.width = `${computedWidth}px`;\n      };\n\n      const onMouseUp = (e: MouseEvent) => {\n        e.preventDefault();\n\n        document.removeEventListener('mousemove', onMouseMove);\n        document.removeEventListener('mouseup', onMouseUp);\n\n        const transaction = tr.setNodeMarkup(getPos(), undefined, {\n          src: node.attrs.src,\n          width: outer.style.width\n        });\n\n        const resolvedPos = transaction.doc.resolve(getPos());\n        const newSelection = new NodeSelection(resolvedPos);\n\n        transaction.setSelection(newSelection);\n        dispatch(transaction);\n      };\n\n      document.addEventListener('mousemove', onMouseMove);\n      document.addEventListener('mouseup', onMouseUp);\n    };\n\n    handleBottomRight.addEventListener('mousedown', resizePropoptionally, { once: true });\n    handleTopRight.addEventListener('mousedown', resizePropoptionally, { once: true });\n    handleTopLeft.addEventListener('mousedown', resizePropoptionally, { once: true });\n    handleBottomLeft.addEventListener('mousedown', resizePropoptionally, { once: true });\n\n    handle.appendChild(handleBottomRight);\n    handle.appendChild(handleTopRight);\n    handle.appendChild(handleTopLeft);\n    handle.appendChild(handleBottomLeft);\n\n    outer.appendChild(handle);\n    outer.appendChild(img);\n\n    this.dom = outer;\n    this.img = img;\n    this.handle = handle;\n  }\n\n  selectNode(): void {\n    this.dom.classList.add(WRAPPER_RESIZE_ACTIVE_CLASSNAME);\n    this.handle.style.display = 'block';\n  }\n\n  deselectNode(): void {\n    this.dom.classList.remove(WRAPPER_RESIZE_ACTIVE_CLASSNAME);\n    this.handle.style.display = 'none';\n  }\n}\n\nconst defaultOptions = {\n  resize: true,\n};\n\nconst imagePlugin = (opts = defaultOptions): Plugin => {\n  const options = { ...defaultOptions, ...opts };\n\n  return new Plugin({\n    key: new PluginKey('link'),\n    props: {\n      nodeViews: {\n        image: (node: ProsemirrorNode, view: EditorView, getPos: () => number) => {\n          if (!options.resize) {\n            return null;\n          }\n          return new ImageRezieView(node, view, getPos);\n        },\n      }\n    }\n  });\n};\n\nexport default imagePlugin;\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"]}