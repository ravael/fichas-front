{"version":3,"file":"ngx-editor-plugins.js","sources":["../../../src/plugins/placeholder.ts","../../../src/plugins/editable.ts","../../../src/plugins/image.ts","../../../src/plugins/ngx-editor-plugins.ts"],"sourcesContent":["import { Plugin, EditorState, PluginKey, Transaction } from 'prosemirror-state';\nimport { DecorationSet, Decoration } from 'prosemirror-view';\n\nconst PLACEHOLDER_CLASSNAME = 'NgxEditor__Placeholder';\n\nconst placeholderPlugin = (text?: string): Plugin => {\n  return new Plugin({\n    key: new PluginKey('placeholder'),\n    state: {\n      init(): string {\n        return text ?? '';\n      },\n      apply(tr: Transaction, previousVal: string): string {\n        const placeholder = tr.getMeta('UPDATE_PLACEHOLDER') ?? previousVal;\n        return placeholder;\n      }\n    },\n    props: {\n      decorations(state: EditorState): DecorationSet {\n        const doc = state.doc;\n\n        const placeholder = this.getState(state);\n\n        if (!placeholder) {\n          return DecorationSet.empty;\n        }\n\n        if (doc.childCount === 1 && doc?.firstChild?.isTextblock && doc.firstChild.content.size === 0) {\n          const placeHolderEl = document.createElement('span');\n          placeHolderEl.classList.add(PLACEHOLDER_CLASSNAME);\n          placeHolderEl.textContent = placeholder;\n          return DecorationSet.create(doc, [Decoration.widget(1, placeHolderEl)]);\n        }\n\n        return DecorationSet.empty;\n      }\n    }\n  });\n};\n\nexport default placeholderPlugin;\n","import { EditorState, Plugin, PluginKey, Transaction } from 'prosemirror-state';\n\nconst editablePlugin = (editable = true) => {\n  return new Plugin({\n    key: new PluginKey('editable'),\n    state: {\n      init(): boolean {\n        return editable;\n      },\n      apply(tr: Transaction, previousVal: boolean): string {\n        return tr.getMeta('UPDATE_EDITABLE') ?? previousVal;\n      }\n    },\n    props: {\n      editable(state: EditorState): boolean {\n        return this.getState(state);\n      },\n      attributes(state: EditorState): Record<string, string> | null {\n        const isEnabled = this.getState(state);\n\n        if (isEnabled) {\n          return null;\n        }\n\n        return {\n          class: 'NgxEditor__Content--Disabled'\n        };\n      }\n    }\n  });\n};\n\nexport default editablePlugin;\n","import { Node as ProsemirrorNode } from 'prosemirror-model';\nimport { NodeSelection, Plugin, PluginKey } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\n\nconst WRAPPER_CLASSNAME = 'NgxEditor__ImageWrapper';\nconst WRAPPER_RESIZE_ACTIVE_CLASSNAME = 'NgxEditor__Resizer--Active';\nconst RESIZE_HANDLE_CLASSNAME = 'NgxEditor__ResizeHandle';\n\nconst createHandle = (direction: string): HTMLElement => {\n  const handle = document.createElement('span');\n  handle.className = `${RESIZE_HANDLE_CLASSNAME}--${direction}`;\n  return handle;\n};\n\nclass ImageRezieView {\n  img: HTMLElement;\n  dom: HTMLElement;\n  handle: HTMLElement;\n\n  constructor(node: ProsemirrorNode, view: EditorView, getPos: () => number) {\n    const outer = document.createElement('span');\n    outer.className = WRAPPER_CLASSNAME;\n    outer.style.width = node.attrs.width;\n\n    const handle = document.createElement('span');\n    handle.className = RESIZE_HANDLE_CLASSNAME;\n\n    const img = document.createElement('img');\n    img.setAttribute('src', node.attrs.src);\n    img.setAttribute('alt', node.attrs.alt ?? '');\n    img.setAttribute('title', node.attrs.title ?? '');\n    img.style.width = '100%';\n    img.style.height = '100%';\n\n    const handleBottomRight = createHandle('BR');\n    const handleTopRight = createHandle('TL');\n    const handleTopLeft = createHandle('TR');\n    const handleBottomLeft = createHandle('BL');\n\n    const resizePropoptionally = (evt: MouseEvent) => {\n      evt.preventDefault();\n\n      const { state, dispatch } = view;\n      const { tr } = state;\n\n      const startX = evt.pageX;\n      const startWidth = img.clientWidth;\n\n      const { width } = window.getComputedStyle(view.dom);\n      const editorWidth = parseInt(width, 10);\n\n      const onMouseMove = (e: MouseEvent) => {\n        const currentX = e.pageX;\n        const diffInPx = currentX - startX;\n        const computedWidth = startWidth + diffInPx;\n\n        // prevent image overflow the editor\n        // prevent resizng below 20px\n        if (computedWidth > editorWidth || computedWidth < 20) {\n          return;\n        }\n\n        outer.style.width = `${computedWidth}px`;\n      };\n\n      const onMouseUp = (e: MouseEvent) => {\n        e.preventDefault();\n\n        document.removeEventListener('mousemove', onMouseMove);\n        document.removeEventListener('mouseup', onMouseUp);\n\n        const transaction = tr.setNodeMarkup(getPos(), undefined, {\n          src: node.attrs.src,\n          width: outer.style.width\n        });\n\n        const resolvedPos = transaction.doc.resolve(getPos());\n        const newSelection = new NodeSelection(resolvedPos);\n\n        transaction.setSelection(newSelection);\n        dispatch(transaction);\n      };\n\n      document.addEventListener('mousemove', onMouseMove);\n      document.addEventListener('mouseup', onMouseUp);\n    };\n\n    handleBottomRight.addEventListener('mousedown', resizePropoptionally, { once: true });\n    handleTopRight.addEventListener('mousedown', resizePropoptionally, { once: true });\n    handleTopLeft.addEventListener('mousedown', resizePropoptionally, { once: true });\n    handleBottomLeft.addEventListener('mousedown', resizePropoptionally, { once: true });\n\n    handle.appendChild(handleBottomRight);\n    handle.appendChild(handleTopRight);\n    handle.appendChild(handleTopLeft);\n    handle.appendChild(handleBottomLeft);\n\n    outer.appendChild(handle);\n    outer.appendChild(img);\n\n    this.dom = outer;\n    this.img = img;\n    this.handle = handle;\n  }\n\n  selectNode(): void {\n    this.dom.classList.add(WRAPPER_RESIZE_ACTIVE_CLASSNAME);\n    this.handle.style.display = 'block';\n  }\n\n  deselectNode(): void {\n    this.dom.classList.remove(WRAPPER_RESIZE_ACTIVE_CLASSNAME);\n    this.handle.style.display = 'none';\n  }\n}\n\nconst defaultOptions = {\n  resize: true,\n};\n\nconst imagePlugin = (opts = defaultOptions): Plugin => {\n  const options = { ...defaultOptions, ...opts };\n\n  return new Plugin({\n    key: new PluginKey('link'),\n    props: {\n      nodeViews: {\n        image: (node: ProsemirrorNode, view: EditorView, getPos: () => number) => {\n          if (!options.resize) {\n            return null;\n          }\n          return new ImageRezieView(node, view, getPos);\n        },\n      }\n    }\n  });\n};\n\nexport default imagePlugin;\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":";;;AAGA,MAAM,qBAAqB,GAAG,wBAAwB,CAAC;MAEjD,iBAAiB,GAAG,CAAC,IAAa;IACtC,OAAO,IAAI,MAAM,CAAC;QAChB,GAAG,EAAE,IAAI,SAAS,CAAC,aAAa,CAAC;QACjC,KAAK,EAAE;YACL,IAAI;gBACF,OAAO,IAAI,aAAJ,IAAI,cAAJ,IAAI,GAAI,EAAE,CAAC;aACnB;YACD,KAAK,CAAC,EAAe,EAAE,WAAmB;;gBACxC,MAAM,WAAW,SAAG,EAAE,CAAC,OAAO,CAAC,oBAAoB,CAAC,mCAAI,WAAW,CAAC;gBACpE,OAAO,WAAW,CAAC;aACpB;SACF;QACD,KAAK,EAAE;YACL,WAAW,CAAC,KAAkB;;gBAC5B,MAAM,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC;gBAEtB,MAAM,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;gBAEzC,IAAI,CAAC,WAAW,EAAE;oBAChB,OAAO,aAAa,CAAC,KAAK,CAAC;iBAC5B;gBAED,IAAI,GAAG,CAAC,UAAU,KAAK,CAAC,WAAI,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,UAAU,0CAAE,WAAW,CAAA,IAAI,GAAG,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,KAAK,CAAC,EAAE;oBAC7F,MAAM,aAAa,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;oBACrD,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;oBACnD,aAAa,CAAC,WAAW,GAAG,WAAW,CAAC;oBACxC,OAAO,aAAa,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,EAAE,aAAa,CAAC,CAAC,CAAC,CAAC;iBACzE;gBAED,OAAO,aAAa,CAAC,KAAK,CAAC;aAC5B;SACF;KACF,CAAC,CAAC;AACL,EAAE;;;MCpCI,cAAc,GAAG,CAAC,QAAQ,GAAG,IAAI;IACrC,OAAO,IAAI,MAAM,CAAC;QAChB,GAAG,EAAE,IAAI,SAAS,CAAC,UAAU,CAAC;QAC9B,KAAK,EAAE;YACL,IAAI;gBACF,OAAO,QAAQ,CAAC;aACjB;YACD,KAAK,CAAC,EAAe,EAAE,WAAoB;;gBACzC,aAAO,EAAE,CAAC,OAAO,CAAC,iBAAiB,CAAC,mCAAI,WAAW,CAAC;aACrD;SACF;QACD,KAAK,EAAE;YACL,QAAQ,CAAC,KAAkB;gBACzB,OAAO,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;aAC7B;YACD,UAAU,CAAC,KAAkB;gBAC3B,MAAM,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;gBAEvC,IAAI,SAAS,EAAE;oBACb,OAAO,IAAI,CAAC;iBACb;gBAED,OAAO;oBACL,KAAK,EAAE,8BAA8B;iBACtC,CAAC;aACH;SACF;KACF,CAAC,CAAC;AACL,EAAE;;;AC1BF,MAAM,iBAAiB,GAAG,yBAAyB,CAAC;AACpD,MAAM,+BAA+B,GAAG,4BAA4B,CAAC;AACrE,MAAM,uBAAuB,GAAG,yBAAyB,CAAC;AAE1D,MAAM,YAAY,GAAG,CAAC,SAAiB;IACrC,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;IAC9C,MAAM,CAAC,SAAS,GAAG,GAAG,uBAAuB,KAAK,SAAS,EAAE,CAAC;IAC9D,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC;;AAEF,MAAM,cAAc;IAKlB,YAAY,IAAqB,EAAE,IAAgB,EAAE,MAAoB;;QACvE,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAC7C,KAAK,CAAC,SAAS,GAAG,iBAAiB,CAAC;QACpC,KAAK,CAAC,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC;QAErC,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAC9C,MAAM,CAAC,SAAS,GAAG,uBAAuB,CAAC;QAE3C,MAAM,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC1C,GAAG,CAAC,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACxC,GAAG,CAAC,YAAY,CAAC,KAAK,QAAE,IAAI,CAAC,KAAK,CAAC,GAAG,mCAAI,EAAE,CAAC,CAAC;QAC9C,GAAG,CAAC,YAAY,CAAC,OAAO,QAAE,IAAI,CAAC,KAAK,CAAC,KAAK,mCAAI,EAAE,CAAC,CAAC;QAClD,GAAG,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;QACzB,GAAG,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;QAE1B,MAAM,iBAAiB,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;QAC7C,MAAM,cAAc,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;QAC1C,MAAM,aAAa,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;QACzC,MAAM,gBAAgB,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;QAE5C,MAAM,oBAAoB,GAAG,CAAC,GAAe;YAC3C,GAAG,CAAC,cAAc,EAAE,CAAC;YAErB,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC;YACjC,MAAM,EAAE,EAAE,EAAE,GAAG,KAAK,CAAC;YAErB,MAAM,MAAM,GAAG,GAAG,CAAC,KAAK,CAAC;YACzB,MAAM,UAAU,GAAG,GAAG,CAAC,WAAW,CAAC;YAEnC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpD,MAAM,WAAW,GAAG,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;YAExC,MAAM,WAAW,GAAG,CAAC,CAAa;gBAChC,MAAM,QAAQ,GAAG,CAAC,CAAC,KAAK,CAAC;gBACzB,MAAM,QAAQ,GAAG,QAAQ,GAAG,MAAM,CAAC;gBACnC,MAAM,aAAa,GAAG,UAAU,GAAG,QAAQ,CAAC;;;gBAI5C,IAAI,aAAa,GAAG,WAAW,IAAI,aAAa,GAAG,EAAE,EAAE;oBACrD,OAAO;iBACR;gBAED,KAAK,CAAC,KAAK,CAAC,KAAK,GAAG,GAAG,aAAa,IAAI,CAAC;aAC1C,CAAC;YAEF,MAAM,SAAS,GAAG,CAAC,CAAa;gBAC9B,CAAC,CAAC,cAAc,EAAE,CAAC;gBAEnB,QAAQ,CAAC,mBAAmB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;gBACvD,QAAQ,CAAC,mBAAmB,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;gBAEnD,MAAM,WAAW,GAAG,EAAE,CAAC,aAAa,CAAC,MAAM,EAAE,EAAE,SAAS,EAAE;oBACxD,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG;oBACnB,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,KAAK;iBACzB,CAAC,CAAC;gBAEH,MAAM,WAAW,GAAG,WAAW,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,CAAC;gBACtD,MAAM,YAAY,GAAG,IAAI,aAAa,CAAC,WAAW,CAAC,CAAC;gBAEpD,WAAW,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;gBACvC,QAAQ,CAAC,WAAW,CAAC,CAAC;aACvB,CAAC;YAEF,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;YACpD,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;SACjD,CAAC;QAEF,iBAAiB,CAAC,gBAAgB,CAAC,WAAW,EAAE,oBAAoB,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;QACtF,cAAc,CAAC,gBAAgB,CAAC,WAAW,EAAE,oBAAoB,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;QACnF,aAAa,CAAC,gBAAgB,CAAC,WAAW,EAAE,oBAAoB,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;QAClF,gBAAgB,CAAC,gBAAgB,CAAC,WAAW,EAAE,oBAAoB,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;QAErF,MAAM,CAAC,WAAW,CAAC,iBAAiB,CAAC,CAAC;QACtC,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;QACnC,MAAM,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;QAClC,MAAM,CAAC,WAAW,CAAC,gBAAgB,CAAC,CAAC;QAErC,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QAC1B,KAAK,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QAEvB,IAAI,CAAC,GAAG,GAAG,KAAK,CAAC;QACjB,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACf,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;KACtB;IAED,UAAU;QACR,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC;QACxD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;KACrC;IAED,YAAY;QACV,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,+BAA+B,CAAC,CAAC;QAC3D,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;KACpC;CACF;AAED,MAAM,cAAc,GAAG;IACrB,MAAM,EAAE,IAAI;CACb,CAAC;MAEI,WAAW,GAAG,CAAC,IAAI,GAAG,cAAc;IACxC,MAAM,OAAO,mCAAQ,cAAc,GAAK,IAAI,CAAE,CAAC;IAE/C,OAAO,IAAI,MAAM,CAAC;QAChB,GAAG,EAAE,IAAI,SAAS,CAAC,MAAM,CAAC;QAC1B,KAAK,EAAE;YACL,SAAS,EAAE;gBACT,KAAK,EAAE,CAAC,IAAqB,EAAE,IAAgB,EAAE,MAAoB;oBACnE,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;wBACnB,OAAO,IAAI,CAAC;qBACb;oBACD,OAAO,IAAI,cAAc,CAAC,IAAI,EAAE,IAAI,EAAE,MAAM,CAAC,CAAC;iBAC/C;aACF;SACF;KACF,CAAC,CAAC;AACL,EAAE;;;ACxIF;;;;;;"}